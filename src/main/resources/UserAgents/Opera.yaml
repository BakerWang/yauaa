#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2016 Niels Basjes
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#

config:

  - matcher:
      extract:
        - 'LayoutEngineClass          : 2010:"Browser"'
        - 'LayoutEngineName           : 2010:"Presto"'
        - 'LayoutEngineVersion        : 2010:"1"'
        - 'AgentClass                 : 2010:"Browser"'
        - 'AgentName                  : 2010:"Opera"'
        - 'AgentVersion               : 2010:agent.product.name="Opera"^.version'

  - matcher:
      require:
        - 'agent.product.name="Opera"'
      extract:
        - 'LayoutEngineClass          : 2011:"Browser"'
        - 'LayoutEngineName           : 2011:"Presto"'
        - 'LayoutEngineVersion        : 2011:agent.product.name="Presto"^.version'
        - 'AgentClass                 : 2011:"Browser"'
        - 'AgentName                  : 2011:"Opera"'
        - 'AgentVersion               : 2011:agent.product.name="Version"^.version'

# https://en.m.wikipedia.org/wiki/Presto_(layout_engine)
# OPR Implies the BLink engine instead of Presto
  - matcher:
      extract:
        - 'LayoutEngineClass          : 2020:"Browser"'
        - 'LayoutEngineName           : 2020:"Blink"'
        - 'LayoutEngineVersion        : 2020:agent.product.name="Chrome"^.version'
        - 'AgentClass                 : 2020:"Browser"'
        - 'AgentName                  : 2020:"Opera"'
        - 'AgentVersion               : 2020:agent.product.name="Opr"^.version'

  - test:
      input:
        user_agent_string: 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; en) Opera 9.51'
      expected:
        DeviceClass                        : 'Desktop'
        DeviceName                         : 'Desktop'
        OperatingSystemClass               : 'Desktop'
        OperatingSystemName                : 'Windows NT'
        OperatingSystemVersion             : 'Windows XP'
        LayoutEngineClass                  : 'Browser'
        LayoutEngineName                   : 'Presto'
        LayoutEngineVersion                : '1'
        AgentClass                         : 'Browser'
        AgentName                          : 'Opera'
        AgentVersion                       : '9.51'


  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Windows NT 6.0; U; en; rv:1.8.1) Gecko/20061208 Firefox/2.0.0 Opera 9.51'
      expected:
        DeviceClass                        : 'Desktop'
        DeviceName                         : 'Desktop'
        OperatingSystemClass               : 'Desktop'
        OperatingSystemName                : 'Windows NT'
        OperatingSystemVersion             : 'Windows Vista'
        LayoutEngineClass                  : 'Browser'
        LayoutEngineName                   : 'Presto'
        LayoutEngineVersion                : '1'
        LayoutEngineBuild                  : '20061208'
        AgentClass                         : 'Browser'
        AgentName                          : 'Opera'
        AgentVersion                       : '9.51'

  - test:
      input:
        user_agent_string: 'Opera/9.51 (Windows NT 5.1; U; en)'
      expected:
        DeviceClass                        : 'Desktop'
        DeviceName                         : 'Desktop'
        OperatingSystemClass               : 'Desktop'
        OperatingSystemName                : 'Windows NT'
        OperatingSystemVersion             : 'Windows XP'
        LayoutEngineClass                  : 'Browser'
        LayoutEngineName                   : 'Presto'
        LayoutEngineVersion                : '1'
        AgentClass                         : 'Browser'
        AgentName                          : 'Opera'
        AgentVersion                       : '9.51'



  - test:
      input:
        user_agent_string: 'Opera/9.80 (Windows NT 6.1; Win64; x64) Presto/2.12.388 Version/12.16'
      expected:
        DeviceClass                        : 'Desktop'
        DeviceName                         : 'Desktop'
        OperatingSystemClass               : 'Desktop'
        OperatingSystemName                : 'Windows NT'
        OperatingSystemVersion             : 'Windows 7'
        LayoutEngineClass                  : 'Browser'
        LayoutEngineName                   : 'Presto'
        LayoutEngineVersion                : '2.12.388'
        AgentClass                         : 'Browser'
        AgentName                          : 'Opera'
        AgentVersion                       : '12.16'
        DeviceCpu                          : 'x64'

  - matcher:
      extract:
        - 'AgentClass            :   2012:"Browser"'
        - 'AgentName             :   2012:"Opera Mini"'
        - 'AgentVersion          :   2012:agent.product.comments.entry.product.(1)name="Opera Mini"^.version'
        - 'DeviceClass           :      1:"Mobile"'

  - test:
      input:
        user_agent_string: 'Opera/9.80 (Android; Opera Mini/7.6.40234/36.1344; U; nl) Presto/2.12.423 Version/12.16'
      expected:
        DeviceClass                        : 'Mobile'
        DeviceName                         : 'Android Mobile'
        OperatingSystemClass               : 'Mobile'
        OperatingSystemName                : 'Android'
        OperatingSystemVersion             : '??'
        LayoutEngineClass                  : 'Browser'
        LayoutEngineName                   : 'Presto'
        LayoutEngineVersion                : '2.12.423'
        AgentClass                         : 'Browser'
        AgentName                          : 'Opera Mini'
        AgentVersion                       : '7.6.40234'
        AgentLanguage                      : 'Dutch'
        AgentSecurity                      : 'Strong security'

  - matcher:
      extract:
        - 'AgentClass            :   2012:"Browser"'
        - 'AgentName             :   2012:"Opera Tablet"'
        - 'AgentVersion          :   2012:agent.product.comments.entry.product.name="Opera Tablet"^.version'

  - test:
      input:
        user_agent_string: 'Opera/9.80 (Windows NT 6.1; Opera Tablet/15165; U; en) Presto/2.8.149 Version/11.1'
      expected:
        DeviceClass                        : 'Desktop'
        DeviceName                         : 'Desktop'
        OperatingSystemClass               : 'Desktop'
        OperatingSystemName                : 'Windows NT'
        OperatingSystemVersion             : 'Windows 7'
        LayoutEngineClass                  : 'Browser'
        LayoutEngineName                   : 'Presto'
        LayoutEngineVersion                : '2.8.149'
        AgentClass                         : 'Browser'
        AgentName                          : 'Opera Tablet'
        AgentVersion                       : '15165'
        AgentLanguage                      : 'English'
        AgentSecurity                      : 'Strong security'


  # Chrome on iOS
  - matcher:
      extract:
        - 'AgentClass            :   2014:"Browser"'
        - 'AgentName             :   2014:"Opera"'
        - 'AgentVersion          :   2014:agent.product.(1)name="OPiOS"^.version'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 9_3_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) OPiOS/13.0.1.100754 Mobile/13E238 Safari/9537.53'
      expected:
        DeviceClass                        : 'Tablet'                   # 100
        DeviceName                         : 'iPad'                     # 100
        DeviceBrand                        : 'Apple'                    # 100
        DeviceFirmwareVersion              : '13E238'                   # 20
        DeviceVersion                      : 'iPad'                     # 100
        OperatingSystemNameVersion         : 'iOS 9.3.1'                # 20
        OperatingSystemClass               : 'Mobile'                   # 20
        OperatingSystemName                : 'iOS'                      # 20
        OperatingSystemVersion             : '9.3.1'                    # 20
        LayoutEngineClass                  : 'Browser'                  # 11
        LayoutEngineName                   : 'AppleWebKit'              # 11
        LayoutEngineVersion                : '601.1.46'                 # 11
        LayoutEngineVersionMajor           : '601'                      # 11
        LayoutEngineNameVersion            : 'AppleWebKit 601.1.46'     # 11
        LayoutEngineNameVersionMajor       : 'AppleWebKit 601'          # 11
        AgentClass                         : 'Browser'                  # 2014
        AgentName                          : 'Opera'                    # 2014
        AgentVersion                       : '13.0.1.100754'            # 2014
        AgentVersionMajor                  : '13'                       # 2014
        AgentNameVersion                   : 'Opera 13.0.1.100754'      # 2014
        AgentNameVersionMajor              : 'Opera 13'                 # 2014


  - test:
      input:
      # TODO: Extract J2ME/MIDP
         user_agent_string: 'Opera/9.80 (J2ME/MIDP; Opera Mini/4.2.16402/37.7936; U; en) Presto/2.12.423 Version/12.16'
      expected:
        DeviceClass                          : 'Mobile'                   # 1
        LayoutEngineClass                    : 'Browser'                  # 2011
        LayoutEngineName                     : 'Presto'                   # 2011
        LayoutEngineVersion                  : '2.12.423'                 # 2011
        LayoutEngineVersionMajor             : '2'                        # 2011
        LayoutEngineNameVersion              : 'Presto 2.12.423'          # 2011
        LayoutEngineNameVersionMajor         : 'Presto 2'                 # 2011
        AgentClass                           : 'Browser'                  # 2012
        AgentName                            : 'Opera Mini'               # 2012
        AgentVersion                         : '4.2.16402'                # 2012
        AgentVersionMajor                    : '4'                        # 2012
        AgentNameVersion                     : 'Opera Mini 4.2.16402'     # 2012
        AgentNameVersionMajor                : 'Opera Mini 4'             # 2012
        AgentLanguage                        : 'English'                  # 5
        AgentLanguageCode                    : 'en'                       # 5
        AgentSecurity                        : 'Strong security'          # 50


  - test:
      input:
      # TODO: Extract MAUI Runtime
         user_agent_string: 'Opera/9.80 (MAUI Runtime; Opera Mini/4.4.39010/37.7936; U; nl) Presto/2.12.423 Version/12.16'
      expected:
        DeviceClass                          : 'Mobile'                   # 1
        LayoutEngineClass                    : 'Browser'                  # 2011
        LayoutEngineName                     : 'Presto'                   # 2011
        LayoutEngineVersion                  : '2.12.423'                 # 2011
        LayoutEngineVersionMajor             : '2'                        # 2011
        LayoutEngineNameVersion              : 'Presto 2.12.423'          # 2011
        LayoutEngineNameVersionMajor         : 'Presto 2'                 # 2011
        AgentClass                           : 'Browser'                  # 2012
        AgentName                            : 'Opera Mini'               # 2012
        AgentVersion                         : '4.4.39010'                # 2012
        AgentVersionMajor                    : '4'                        # 2012
        AgentNameVersion                     : 'Opera Mini 4.4.39010'     # 2012
        AgentNameVersionMajor                : 'Opera Mini 4'             # 2012
        AgentLanguage                        : 'Dutch'                    # 5
        AgentLanguageCode                    : 'nl'                       # 5
        AgentSecurity                        : 'Strong security'          # 50


  - test:
      input:
      # TODO: Extract SpreadTrum
         user_agent_string: 'Opera/9.80 (SpreadTrum; Opera Mini/4.4.31492/37.7936; U; en) Presto/2.12.423 Version/12.16'
      expected:
        DeviceClass                          : 'Mobile'                   # 1
        LayoutEngineClass                    : 'Browser'                  # 2011
        LayoutEngineName                     : 'Presto'                   # 2011
        LayoutEngineVersion                  : '2.12.423'                 # 2011
        LayoutEngineVersionMajor             : '2'                        # 2011
        LayoutEngineNameVersion              : 'Presto 2.12.423'          # 2011
        LayoutEngineNameVersionMajor         : 'Presto 2'                 # 2011
        AgentClass                           : 'Browser'                  # 2012
        AgentName                            : 'Opera Mini'               # 2012
        AgentVersion                         : '4.4.31492'                # 2012
        AgentVersionMajor                    : '4'                        # 2012
        AgentNameVersion                     : 'Opera Mini 4.4.31492'     # 2012
        AgentNameVersionMajor                : 'Opera Mini 4'             # 2012
        AgentLanguage                        : 'English'                  # 5
        AgentLanguageCode                    : 'en'                       # 5
        AgentSecurity                        : 'Strong security'          # 50
